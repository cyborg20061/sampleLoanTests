machine:
  node:
    version: 0.10.40


database:
  override:
    - createuser -U postgres -S -D -R earnest
    - createdb -U postgres -O earnest earnest_test
    - for i in `ls config/*.example.js`; do cp $i `echo $i | sed "s/example/test/g"`; done

test:
  override:
    - npm run protractor-tests

checkout:
  post:
    - git submodule sync
    - git submodule update --init

machine:
  java:
    version: openjdk8
    
dependencies:
  post:
    - wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
    - tar -xzf sc-latest-linux.tar.gz

test:
  override:
    - cd sc-*-linux && ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY -f ~/sc_ready:
        background: true
    # Wait for tunnel to be ready
    - while [ ! -e ~/sc_ready ]; do sleep 1; done

    # Clean and build the project
    - mvn clean

    # Run selenium tests
    - mvn -Dtest=SmokeTestSuite test
